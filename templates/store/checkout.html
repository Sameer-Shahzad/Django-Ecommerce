{% extends 'base.html' %}
{% load static %}

{% block content %}
<section class="py-10 bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4">
        <div class="flex flex-col lg:flex-row gap-6">
            
            <aside class="w-full lg:w-2/3">
                <div class="p-6 bg-white border rounded-lg shadow-sm font-sans">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Billing Address</h2>

                    <form action="{% url 'place_order' %}" method="POST" class="space-y-5">
                        {% csrf_token %}
                        <div class="flex flex-wrap gap-4">
                            <div class="flex-1 min-w-[250px]">
                                <label class="block text-sm text-gray-600 mb-1">First Name</label>
                                <input type="text" name="first_name" class="w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-400 outline-none">
                            </div>
                            <div class="flex-1 min-w-[250px]">
                                <label class="block text-sm text-gray-600 mb-1">Last Name</label>
                                <input type="text" name="last_name" class="w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-400 outline-none">
                            </div>
                        </div>

                        <div class="flex flex-wrap gap-4">
                            <div class="flex-1 min-w-[250px]">
                                <label class="block text-sm text-gray-600 mb-1">Email</label>
                                <input type="email" name="email" class="w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-400 outline-none">
                            </div>
                            <div class="flex-1 min-w-[250px]">
                                <label class="block text-sm text-gray-600 mb-1">Phone Number</label>
                                <input type="tel" name="phone" class="w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-400 outline-none">
                            </div>
                        </div>

                        <div class="flex flex-wrap gap-4">
                            <div class="flex-1 min-w-[250px]">
                                <label class="block text-sm text-gray-600 mb-1">Address Line 1</label>
                                <input type="text" name="address_line_1" class="w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-400 outline-none">
                            </div>
                            <div class="flex-1 min-w-[250px]">
                                <label class="block text-sm text-gray-600 mb-1">Address Line 2</label>
                                <input type="text" name="address_line_2" class="w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-400 outline-none">
                            </div>
                        </div>

                        <div class="flex flex-wrap gap-4">
                            <div class="flex-1 min-w-[150px]">
                                <label class="block text-sm text-gray-600 mb-1">City</label>
                                <input type="text" name="city" class="w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-400 outline-none">
                            </div>
                            <div class="flex-1 min-w-[150px]">
                                <label class="block text-sm text-gray-600 mb-1">State</label>
                                <input type="text" name="state" class="w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-400 outline-none">
                            </div>
                            <div class="flex-1 min-w-[150px]">
                                <label class="block text-sm text-gray-600 mb-1">Country</label>
                                <input type="text" name="country" class="w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-400 outline-none">
                            </div>
                        </div>

                        <div class="flex flex-col">
                            <label class="block text-sm text-gray-600 mb-1">Order Note</label>
                            <textarea name="order_note" rows="3" class="w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-400 outline-none"></textarea>
                        </div>
                        
                        <button type="submit" id="submit-form" class="hidden"></button>
                    </form>
                </div>
            </aside>

            <aside class="w-full lg:w-1/2">
                <div class="bg-white rounded-lg shadow-md p-6 sticky top-4">
                    <h5 class="text-xl font-bold mb-4 border-b pb-2 text-gray-800">Order Summary</h5>

                    {% if not cart_items %}
                        <div class="text-center py-6">
                            <p class="text-gray-500 mb-4">Your cart is empty.</p>
                            <a href="{% url 'store' %}" class="text-blue-600 font-bold hover:underline">Continue Shopping</a>
                        </div>
                    {% else %}
                        <div class="overflow-hidden mb-4">
                           <div class="space-y-4 mb-4">
                                {% for item in cart_items %}
                                <div class="grid grid-cols-12 items-center border-b pb-3 gap-2">
                                    
                                    <div class="col-span-6 flex items-center gap-3">
                                        <img src="{{ item.product.product_image.url }}" class="w-10 h-10 rounded shadow-sm flex-shrink-0">
                                        <div class="min-w-0"> <p class="text-xs font-bold text-gray-800 truncate">{{ item.product.product_name }}</p>
                                            <div class="flex flex-wrap gap-1">
                                                {% for v in item.variations.all %}
                                                    <span class="text-[9px] text-gray-500 bg-gray-100 px-1 rounded">{{ v.variation_value }}</span>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-span-4 flex items-center justify-center gap-2">
                                        <a href="{% url 'remove_cart' item.product.id item.id %}" class="w-6 h-6 flex items-center justify-center bg-gray-100 rounded text-xs hover:bg-gray-200">-</a>
                                        
                                        <span class="text-xs font-bold w-4 text-center">{{ item.quantity }}</span>

                                        <form action="{% url 'add_cart' item.product.id %}" method="POST" class="inline">
                                            {% csrf_token %}
                                            {% for v in item.variations.all %}
                                                <input type="hidden" name="{{ v.variation_category | lower }}" value="{{ v.variation_value }}">
                                            {% endfor %}
                                            <button type="submit" class="w-6 h-6 flex items-center justify-center bg-gray-100 rounded text-xs hover:bg-gray-200">+</button>
                                        </form>
                                    </div>

                                    <div class="col-span-2 text-right">
                                        <a href="{% url 'remove_all_cart' item.product.id item.id %}" class="text-red-400 hover:text-red-600 font-bold text-sm">âœ•</a>
                                    </div>
                                    
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="bg-gray-50 p-4 rounded-lg space-y-2 mb-6">
                            <div class="flex justify-between text-sm text-gray-600">
                                <span>Tax:</span>
                                <span>${{ tax }}</span>
                            </div>
                            <div class="flex justify-between text-lg font-black text-gray-900 border-t pt-2">
                                <span>Total:</span>
                                <span>${{ grand_total }}</span>
                            </div>
                        </div>

                        <div class="space-y-3">
                            <button onclick="document.getElementById('submit-form').click();" class="block w-full bg-blue-600 text-white text-center py-3 rounded-md font-semibold hover:bg-blue-700 transition">
                                Place Order
                            </button>
                            
                            <a href="{% url 'store' %}" class="block w-full bg-gray-100 text-gray-700 text-center py-3 rounded-md font-semibold border border-gray-300 hover:bg-gray-200 transition">
                                Continue Shopping
                            </a>
                        </div>

                        <div class="mt-6 flex justify-center border-t pt-4">
                            <img src="{% static 'images/misc/payments.png' %}" alt="payments" class="h-6 object-contain opacity-80">
                        </div>
                    {% endif %}
                </div>
            </aside>

        </div>
    </div>
</section>
{% endblock %}